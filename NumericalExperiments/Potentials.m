%% Data for 4th order potential
% Forumulas are derived in
% MatlabConverterPhi2.nb/ModifiedIntegral_AnsatzPolyVN.nb using order2Data.nb

global alpha c dt dx v

% data
dx = 0.001;
dt = 0.0012;
alpha = -1;
c = 2;
% we require V(0)=0
v = -[0.5,2,0,0]; % V = v[1]s+1/2v[2]s^2+1/6 v[3]s^3 + 1/24 v[4]s^4


H = @(z) (1/2).*((-1)+c.^2).^(-1).*(alpha.^2.*z(1,:).^2+alpha.^2.*z(2,:).^2+v(1).*(z(1,:).^2+z(2,:).^2)+(1/2).*v(2).*(z(1,:).^2+z(2,:).^2).^2+(1/6).*v(3).*(z(1,:).^2+z(2,:).^2).^3+(1/24).*v(4).*(z(1,:).^2+z(2,:).^2).^4+(-1/24).*c.^2.*(z(1,:).^2+z(2,:).^2).*(24.*v(1)+(z(1,:).^2+z(2,:).^2).*(12.*v(2)+(z(1,:).^2+z(2,:).^2).*(4.*v(3)+v(4).*(z(1,:).^2+z(2,:).^2))))+2.*alpha.*c.*z(2,:).*z(3,:)+z(3,:).^2+(-2).*alpha.*c.*z(1,:).*z(4,:)+z(4,:).^2);

Hq = @(q,p) [(-1/6).*((-1)+c.^2).^(-1).*(6.*alpha.*c.*p(2)+(-6).*alpha.^2.*q(1)+((-1)+c.^2).*q(1).*(6.*v(1)+(q(1).^2+q(2).^2).*(6.*v(2)+(q(1).^2+q(2).^2).*(3.*v(3)+(q(1).^2+q(2).^2).*v(4))))),(1/6).*((-1)+c.^2).^(-1).*(6.*alpha.*c.*p(1)+6.*alpha.^2.*q(2)+(-1).*((-1)+c.^2).*q(2).*(6.*v(1)+(q(1).^2+q(2).^2).*(6.*v(2)+(q(1).^2+q(2).^2).*(3.*v(3)+(q(1).^2+q(2).^2).*v(4)))))]';
Hp = @(q,p) [((-1)+c.^2).^(-1).*(p(1)+alpha.*c.*q(2)),((-1)+c.^2).^(-1).*(p(2)+(-1).*alpha.*c.*q(1))]';

Hqp = @(~,~) -[0,(-1).*alpha.*c.*((-1)+c.^2).^(-1);alpha.*c.*((-1)+c.^2).^(-1),0];    % Attention: Hpq = - Hqp'

% FMod in external file FModEq for performance
%Fmod = @(~,z) [((-1)+c.^2).^(-1).*(alpha.*c.*z(2)+z(3)),((-1)+c.^2).^(-1).*((-1).*alpha.*c.*z(1)+z(4)),alpha.*c.*((-1)+c.^2).^(-1).*(alpha.*c.*z(1)+(-1).*z(4))+(1/12).*((-1)+c.^2).^(-4).*(z(1).*(alpha.^2.*(12+(-24).*c.^2+24.*c.^6+(-12).*c.^8+(-1).*alpha.^2.*dt.^2+(-6).*alpha.^2.*c.^2.*dt.^2+(-1).*alpha.^2.*c.^4.*dt.^2+alpha.^2.*dx.^2+6.*alpha.^2.*c.^2.*dx.^2+alpha.^2.*c.^4.*dx.^2+2.*((-1)+c.^2).*(c.^4.*dt.^2+(-1).*dx.^2).*z(1).^2.*(v(2)+v(3).*(z(1).^2+z(2).^2)+(1/2).*v(4).*(z(1).^2+z(2).^2).^2)+2.*((-1)+c.^2).*(c.^4.*dt.^2+(-1).*dx.^2).*z(2).^2.*(v(2)+v(3).*(z(1).^2+z(2).^2)+(1/2).*v(4).*(z(1).^2+z(2).^2).^2))+(-2).*((-1)+c.^2).*(6+(-18).*c.^2+18.*c.^4+(-6).*c.^6+(-3).*alpha.^2.*c.^2.*dt.^2+(-1).*alpha.^2.*c.^4.*dt.^2+alpha.^2.*dx.^2+3.*alpha.^2.*c.^2.*dx.^2+((-1)+c.^2).*(c.^4.*dt.^2+(-1).*dx.^2).*z(1).^2.*(v(2)+v(3).*(z(1).^2+z(2).^2)+(1/2).*v(4).*(z(1).^2+z(2).^2).^2)+((-1)+c.^2).*(c.^4.*dt.^2+(-1).*dx.^2).*z(2).^2.*(v(2)+v(3).*(z(1).^2+z(2).^2)+(1/2).*v(4).*(z(1).^2+z(2).^2).^2)).*(v(1)+(1/6).*(z(1).^2+z(2).^2).*(6.*v(2)+(z(1).^2+z(2).^2).*(3.*v(3)+v(4).*(z(1).^2+z(2).^2))))+(-1).*((-1)+c.^2).^2.*(c.^4.*dt.^2+(-1).*dx.^2).*(v(1)+(1/6).*(z(1).^2+z(2).^2).*(6.*v(2)+(z(1).^2+z(2).^2).*(3.*v(3)+v(4).*(z(1).^2+z(2).^2)))).^2+(-8).*alpha.*c.*((-1)+c.^2).*(c.^2.*dt.^2+(-1).*dx.^2).*z(2).*(v(2)+v(3).*(z(1).^2+z(2).^2)+(1/2).*v(4).*(z(1).^2+z(2).^2).^2).*z(3)+(-1).*((-1)+c.^2).*(c.^4.*dt.^2+(-1).*dx.^2).*(6.*v(2)+2.*v(3).*(5.*z(1).^2+3.*z(2).^2)+v(4).*(7.*z(1).^4+10.*z(1).^2.*z(2).^2+3.*z(2).^4)).*z(3).^2)+4.*(alpha.*c.*((-6)+(-18).*c.^4+6.*c.^6+alpha.^2.*dt.^2+(-1).*alpha.^2.*dx.^2+c.^2.*(18+alpha.^2.*(dt.^2+(-1).*dx.^2))+(-2).*((-1)+c.^2).*(c.^2.*dt.^2+(-1).*dx.^2).*z(2).^2.*(v(2)+v(3).*(z(1).^2+z(2).^2)+(1/2).*v(4).*(z(1).^2+z(2).^2).^2))+(-1).*alpha.*c.*((-1)+c.^2).*(c.^2.*dt.^2+(-1).*dx.^2).*(v(1)+(1/6).*(z(1).^2+z(2).^2).*(6.*v(2)+(z(1).^2+z(2).^2).*(3.*v(3)+v(4).*(z(1).^2+z(2).^2))))+(-1/2).*((-1)+c.^2).*(c.^4.*dt.^2+(-1).*dx.^2).*z(2).*(2.*v(2)+2.*v(3).*(3.*z(1).^2+z(2).^2)+v(4).*(5.*z(1).^4+6.*z(1).^2.*z(2).^2+z(2).^4)).*z(3)).*z(4)+(-1).*((-1)+c.^2).*(c.^4.*dt.^2+(-1).*dx.^2).*z(1).*(2.*v(2)+2.*v(3).*(z(1).^2+3.*z(2).^2)+v(4).*(z(1).^4+6.*z(1).^2.*z(2).^2+5.*z(2).^4)).*z(4).^2),(1/12).*((-1)+c.^2).^(-4).*((-1).*((-1)+c.^2).*(c.^4.*dt.^2+(-1).*dx.^2).*z(2).*(2.*v(2)+2.*v(3).*(3.*z(1).^2+z(2).^2)+v(4).*(5.*z(1).^4+6.*z(1).^2.*z(2).^2+z(2).^4)).*z(3).^2+(-4).*z(3).*(alpha.*c.*((-3)+(-9).*c.^4+3.*c.^6+alpha.^2.*dt.^2+(-1).*alpha.^2.*dx.^2+c.^2.*(9+alpha.^2.*(dt.^2+(-1).*dx.^2))+(-2).*((-1)+c.^2).*(c.^2.*dt.^2+(-1).*dx.^2).*z(1).^2.*(v(2)+v(3).*(z(1).^2+z(2).^2)+(1/2).*v(4).*(z(1).^2+z(2).^2).^2))+(-1).*alpha.*c.*((-1)+c.^2).*(c.^2.*dt.^2+(-1).*dx.^2).*(v(1)+(1/6).*(z(1).^2+z(2).^2).*(6.*v(2)+(z(1).^2+z(2).^2).*(3.*v(3)+v(4).*(z(1).^2+z(2).^2))))+(1/2).*((-1)+c.^2).*(c.^4.*dt.^2+(-1).*dx.^2).*z(1).*(2.*v(2)+2.*v(3).*(z(1).^2+3.*z(2).^2)+v(4).*(z(1).^4+6.*z(1).^2.*z(2).^2+5.*z(2).^4)).*z(4))+z(2).*(alpha.^2.*(12+(-36).*c.^2+36.*c.^4+(-12).*c.^6+(-1).*alpha.^2.*dt.^2+(-6).*alpha.^2.*c.^2.*dt.^2+(-1).*alpha.^2.*c.^4.*dt.^2+alpha.^2.*dx.^2+6.*alpha.^2.*c.^2.*dx.^2+alpha.^2.*c.^4.*dx.^2+2.*((-1)+c.^2).*(c.^4.*dt.^2+(-1).*dx.^2).*z(1).^2.*(v(2)+v(3).*(z(1).^2+z(2).^2)+(1/2).*v(4).*(z(1).^2+z(2).^2).^2)+2.*((-1)+c.^2).*(c.^4.*dt.^2+(-1).*dx.^2).*z(2).^2.*(v(2)+v(3).*(z(1).^2+z(2).^2)+(1/2).*v(4).*(z(1).^2+z(2).^2).^2))+(-2).*((-1)+c.^2).*(6+(-18).*c.^2+18.*c.^4+(-6).*c.^6+(-3).*alpha.^2.*c.^2.*dt.^2+(-1).*alpha.^2.*c.^4.*dt.^2+alpha.^2.*dx.^2+3.*alpha.^2.*c.^2.*dx.^2+((-1)+c.^2).*(c.^4.*dt.^2+(-1).*dx.^2).*z(1).^2.*(v(2)+v(3).*(z(1).^2+z(2).^2)+(1/2).*v(4).*(z(1).^2+z(2).^2).^2)+((-1)+c.^2).*(c.^4.*dt.^2+(-1).*dx.^2).*z(2).^2.*(v(2)+v(3).*(z(1).^2+z(2).^2)+(1/2).*v(4).*(z(1).^2+z(2).^2).^2)).*(v(1)+(1/6).*(z(1).^2+z(2).^2).*(6.*v(2)+(z(1).^2+z(2).^2).*(3.*v(3)+v(4).*(z(1).^2+z(2).^2))))+(-1).*((-1)+c.^2).^2.*(c.^4.*dt.^2+(-1).*dx.^2).*(v(1)+(1/6).*(z(1).^2+z(2).^2).*(6.*v(2)+(z(1).^2+z(2).^2).*(3.*v(3)+v(4).*(z(1).^2+z(2).^2)))).^2+8.*alpha.*c.*((-1)+c.^2).*(c.^2.*dt.^2+(-1).*dx.^2).*z(1).*(v(2)+v(3).*(z(1).^2+z(2).^2)+(1/2).*v(4).*(z(1).^2+z(2).^2).^2).*z(4)+(-1).*((-1)+c.^2).*(c.^4.*dt.^2+(-1).*dx.^2).*(6.*v(2)+2.*v(3).*(3.*z(1).^2+5.*z(2).^2)+v(4).*(3.*z(1).^4+10.*z(1).^2.*z(2).^2+7.*z(2).^4)).*z(4).^2))]';

%Imod = @(z) (1/24).*(1+(-1).*c.^2).^(-3).*((-12).*((-1)+c.^2).^2.*(alpha.^2.*z(1,:).^2+alpha.^2.*z(2,:).^2+v(1).*(z(1,:).^2+z(2,:).^2)+(1/2).*v(2).*(z(1,:).^2+z(2,:).^2).^2+(-1/2).*c.^2.*(z(1,:).^2+z(2,:).^2).*(2.*v(1)+v(2).*(z(1,:).^2+z(2,:).^2))+2.*alpha.*c.*z(2,:).*z(3,:)+z(3,:).^2+(-2).*alpha.*c.*z(1,:).*z(4,:)+z(4,:).^2)+(z(1,:).^2+z(2,:).^2).*(alpha.^4.*(1+3.*c.^2).*(dt.^2+(-1).*dx.^2)+alpha.^2.*(dx.^2.*((-2).*v(1)+v(2).*(z(1,:).^2+z(2,:).^2))+(-1).*c.^4.*dt.^2.*(2.*v(1)+7.*v(2).*(z(1,:).^2+z(2,:).^2))+c.^2.*(3.*dt.^2.*(2.*v(1)+v(2).*(z(1,:).^2+z(2,:).^2))+dx.^2.*((-2).*v(1)+3.*v(2).*(z(1,:).^2+z(2,:).^2))))+(-4).*alpha.*c.*(2.*c.^2.*dt.^2+c.^4.*dt.^2+(-3).*dx.^2).*v(2).*(z(2,:).*z(3,:)+(-1).*z(1,:).*z(4,:))+(-1).*(c.^4.*dt.^2+(-1).*dx.^2).*(((-1)+c.^2).*v(1).^2+(-1).*((-1)+c.^2).*v(1).*v(2).*(z(1,:).^2+z(2,:).^2)+v(2).*((-1).*((-1)+c.^2).*v(2).*(z(1,:).^2+z(2,:).^2).^2+6.*(z(3,:).^2+z(4,:).^2)))));
Imod = @(z) (1/24).*(1+(-1).*c.^2).^(-3).*((-12).*((-1)+c.^2).^2.*((-1/2).*(z(1,:).^2+z(2,:).^2).*((-2).*alpha.^2+((-1)+c.^2).*(2.*v(1)+v(2).*(z(1,:).^2+z(2,:).^2)))+2.*alpha.*c.*z(2,:).*z(3,:)+z(3,:).^2+(-2).*alpha.*c.*z(1,:).*z(4,:)+z(4,:).^2)+(z(1,:).^2+z(2,:).^2).*(alpha.^4.*(1+3.*c.^2).*(dt.^2+(-1).*dx.^2)+alpha.^2.*(dx.^2.*((-2).*v(1)+v(2).*(z(1,:).^2+z(2,:).^2))+(-1).*c.^4.*dt.^2.*(2.*v(1)+7.*v(2).*(z(1,:).^2+z(2,:).^2))+c.^2.*(3.*dt.^2.*(2.*v(1)+v(2).*(z(1,:).^2+z(2,:).^2))+dx.^2.*((-2).*v(1)+3.*v(2).*(z(1,:).^2+z(2,:).^2))))+(-4).*alpha.*c.*(2.*c.^2.*dt.^2+c.^4.*dt.^2+(-3).*dx.^2).*v(2).*(z(2,:).*z(3,:)+(-1).*z(1,:).*z(4,:))+(-1).*(c.^4.*dt.^2+(-1).*dx.^2).*(((-1)+c.^2).*v(1).^2+(-1).*((-1)+c.^2).*v(1).*v(2).*(z(1,:).^2+z(2,:).^2)+v(2).*((-1).*((-1)+c.^2).*v(2).*(z(1,:).^2+z(2,:).^2).^2+6.*(z(3,:).^2+z(4,:).^2)))));

DH = @(z) [Hq(z(1:2),z(3:4));Hp(z(1:2),z(3:4))];
F = @(~,z) [Hp(z(1:2),z(3:4));-Hq(z(1:2),z(3:4))];