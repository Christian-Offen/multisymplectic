function zout = H(z,h)
%H Evaluation of Hamiltonian
%   Hamiltonian expression in the variables q,p of the original system.
%   h=0 is the exact Hamiltonian, h=1 the modified Hamiltonian

global V0Fun V1Fun V2Fun a c dt dx

qnorm = z(1,:).^2+z(2,:).^2;

V0 = V0Fun(qnorm);
V1 = V1Fun(qnorm);
V2 = V2Fun(qnorm);

zout=(1/24).*((-1)+c.^2).^(-2).*(12.*((-1)+c.^2).*(z(3,:).^2+z(4,:).^2+z(1,:).^2.*a.^2+z(2,:).^2.*a.^2+2.*z(2,:).*z(3,:).*a.*c+(-2).*z(1,:).*z(4,:).*a.*c+V0+(-1).*c.^2.*V0)+(-1).*h.^2.*((-8).*z(2,:).*a.*c.*(z(3,:)+z(2,:).*a.*c).*((-1)+c.^2).^(-1).*(c.^2.*dt.^2+(-1).*dx.^2).*(a.^2+V1)+2.*((-1)+c.^2).^(-2).*((z(4,:)+(-1).*z(1,:).*a.*c).^2+(z(3,:)+z(2,:).*a.*c).^2).*(a.^2.*(3.*c.^4.*dt.^2+(-1).*dx.^2+c.^2.*(3.*dt.^2+(-5).*dx.^2))+(-1).*((-1)+c.^2).*(c.^4.*dt.^2+(-1).*dx.^2).*V1)+8.*z(1,:).*(z(4,:)+(-1).*z(1,:).*a.*c).*((-1)+c.^2).^(-1).*(a.^3.*c.*(c.^2.*dt.^2+(-1).*dx.^2)+a.*c.*(c.^2.*dt.^2+(-1).*dx.^2).*V1+(-1).*z(2,:).*(z(3,:)+z(2,:).*a.*c).*(c.^4.*dt.^2+(-1).*dx.^2).*V2)+z(2,:).^2.*(a.^4.*(((-1)+2.*c.^2).*dt.^2+(-1).*dx.^2)+2.*a.^2.*(c.^4.*dt.^2+(-1).*dx.^2).*V1+(c.^4.*dt.^2+(-1).*dx.^2).*V1.^2+(-4).*(z(4,:)+(-1).*z(1,:).*a.*c).^2.*((-1)+c.^2).^(-1).*(c.^4.*dt.^2+(-1).*dx.^2).*V2)+z(1,:).^2.*(a.^4.*(((-1)+2.*c.^2).*dt.^2+(-1).*dx.^2)+2.*a.^2.*(c.^4.*dt.^2+(-1).*dx.^2).*V1+(c.^4.*dt.^2+(-1).*dx.^2).*V1.^2+(-4).*(z(3,:)+z(2,:).*a.*c).^2.*((-1)+c.^2).^(-1).*(c.^4.*dt.^2+(-1).*dx.^2).*V2)));


end

